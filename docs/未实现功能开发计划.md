# 未实现功能开发计划与进度跟踪

**项目名称**: STM32 黑白棋 - 未实现功能开发  
**创建日期**: 2025-12-09  
**文档版本**: v1.0  
**负责人**: 开发团队

---

## 文档说明

本文档用于跟踪所有未实现功能的开发进度，包括：
- 详细的任务分解
- 开发状态跟踪
- 代码文件清单
- 测试验收标准

**更新规则**: 每完成一个任务，立即更新状态为完成

---

## 总体进度概览

| 阶段 | 任务数 | 代码量 | 完成数 | 进度 | 状态 |
|------|--------|--------|--------|------|------|
| 阶段1：基础控制层 | 4 | 900行 | 4 | 100% | ✅ 已完成 |
| 阶段2：数据管理层 | 3 | 1150行 | 0 | 0% | 待开始 |
| 阶段3：游戏模式层 | 2 | 830行 | 0 | 0% | 待开始 |
| 阶段4：扩展功能层 | 1 | 420行 | 0 | 0% | 待开始 |
| **总计** | **10** | **3300行** | **4** | **40%** | **进行中** |

**最后更新**: 2025-12-09 (阶段1全部完成)

---

## 阶段1：基础控制层（优先级：最高）

### 任务1.1：上位机串口参数设置对话框

**状态**: ✅ 已完成
**优先级**: 最高
**预计代码量**: 250行
**实际代码量**: 420行
**预计难度**: 简单

#### 功能需求
- [x] 创建串口设置对话框类
- [x] 端口选择（自动扫描可用端口）
- [x] 波特率选择（9600/19200/38400/57600/115200/230400/460800/921600）
- [x] 数据位选择（5/6/7/8）
- [x] 停止位选择（1/1.5/2）
- [x] 校验位选择（None/Odd/Even/Mark/Space）
- [x] 参数保存到配置文件
- [x] 测试连接功能
- [x] 集成到主窗口菜单
- [x] 自动连接选项
- [x] 恢复默认设置功能
- [x] 提示信息显示

#### 文件清单
**新建文件**:
- OthelloPC/gui/serial_settings_dialog.py (约400行)

**修改文件**:
- OthelloPC/gui/main_window.py (添加菜单项和导入，约10行)
- OthelloPC/utils/config.py (添加串口配置项，约10行)

#### 验收标准
- [x] 对话框能正常打开和关闭
- [x] 能扫描并显示所有可用串口
- [x] 所有参数能正确保存和加载
- [x] 测试连接功能正常
- [x] 参数修改后能立即生效
- [x] 界面美观，符合迪特拉姆斯设计风格
- [x] 错误处理完善

#### 开发记录
- **开始时间**: 2025-12-09
- **完成时间**: 2025-12-09
- **实际代码量**: 420行
- **特色功能**:
  - 完整的串口参数配置（端口/波特率/数据位/停止位/校验位）
  - 实时端口扫描和刷新
  - 测试连接功能（验证参数有效性）
  - 自动连接选项（启动时自动连接）
  - 恢复默认设置（一键恢复115200 8N1）
  - 提示信息显示（使用说明）
  - 居中显示对话框

---

### 任务1.2：上位机游戏控制面板

**状态**: ✅ 已完成
**优先级**: 最高
**预计代码量**: 200行
**实际代码量**: 320行
**预计难度**: 简单
**依赖**: 任务1.4（协议扩展） ✅

#### 功能需求
- [x] 创建控制面板组件类
- [x] 添加开始按钮（发送开始命令）
- [x] 添加暂停按钮（发送暂停命令）
- [x] 添加继续按钮（发送继续命令）
- [x] 添加结束按钮（发送结束命令）
- [x] 添加重新开始按钮（发送重置命令）
- [x] 添加模式选择下拉框（普通/闯关/计时）
- [x] 实现按钮状态管理
- [x] 集成到主窗口
- [x] 添加状态显示
- [x] 添加按键提示

#### 文件清单
**新建文件**:
- OthelloPC/gui/control_panel.py (约300行)

**修改文件**:
- OthelloPC/gui/main_window.py (集成控制面板，约20行)

#### 验收标准
- [x] 控制面板正确显示在主窗口
- [x] 所有按钮能正常点击
- [x] 按钮状态根据游戏状态正确切换
- [x] 命令能正确发送到下位机
- [x] 模式选择能正常工作
- [x] 连接状态影响按钮可用性
- [x] 状态显示实时更新

#### 开发记录
- **开始时间**: 2025-12-09
- **完成时间**: 2025-12-09
- **实际代码量**: 320行
- **特色功能**:
  - 完整的按钮状态管理（根据游戏状态自动启用/禁用）
  - 实时状态显示（空闲/进行中/已暂停/已结束）
  - 模式选择支持（普通/闯关/计时）
  - 连接状态检测（未连接时禁用所有控制）
  - 按键提示显示（与下位机按键对应）

---

### 任务1.3：下位机游戏控制功能

**状态**: ✅ 已完成
**优先级**: 最高
**预计代码量**: 300行
**实际代码量**: 350行
**预计难度**: 中等
**依赖**: 任务1.4（协议扩展） ✅

#### 功能需求
- [x] 定义游戏控制状态枚举
- [x] 实现游戏控制状态机
- [x] 添加按键映射（1=开始, *=暂停, #=继续, D=结束, 0=重置）
- [x] 实现开始游戏功能
- [x] 实现暂停/继续功能
- [x] 实现结束游戏功能
- [x] 实现重新开始功能
- [x] 添加协议命令处理
- [x] 暂停时间统计功能
- [x] 有效游戏时间计算

#### 文件清单
**新建文件**:
- Core/Inc/game_control.h (约180行)
- Core/Src/game_control.c (约420行)

**修改文件**:
- Core/Src/main.c (添加CMD_GAME_CONTROL处理和按键集成，约50行)

#### 验收标准
- [x] 按键1能启动新游戏
- [x] 按键*能暂停游戏
- [x] 按键#能继续游戏
- [x] 按键D能结束游戏
- [x] 按键0能重新开始
- [x] 状态机切换正确
- [x] 与上位机命令同步
- [x] 暂停时游戏操作被禁用

#### 开发记录
- **开始时间**: 2025-12-09
- **完成时间**: 2025-12-09
- **实际代码量**: 350行
- **特色功能**:
  - 完整的状态机实现（IDLE/PLAYING/PAUSED/ENDED）
  - 暂停时间统计和有效游戏时间计算
  - 按键和协议双重控制支持
  - 状态验证和错误处理

---

### 任务1.4：通信协议扩展

**状态**: ✅ 已完成
**优先级**: 最高
**预计代码量**: 150行
**实际代码量**: 180行
**预计难度**: 简单
**依赖**: 无

#### 功能需求
- [x] 定义CMD_GAME_CONTROL (0x0C)
- [x] 定义CMD_MODE_SELECT (0x0D)
- [x] 定义CMD_SCORE_UPDATE (0x0E)
- [x] 定义CMD_TIMER_UPDATE (0x0F)
- [x] 实现下位机协议处理函数
- [x] 实现上位机协议发送函数
- [x] 修正PC端协议格式以匹配STM32端

#### 文件清单
**修改文件**:
- Core/Inc/uart_protocol.h (添加命令定义和数据结构，约80行)
- Core/Src/uart_protocol.c (添加发送函数，约70行)
- OthelloPC/communication/serial_handler.py (添加发送函数和修正协议，约100行)

#### 验收标准
- [x] 新命令能正确定义
- [x] 下位机能正确处理新命令
- [x] 上位机能正确发送新命令
- [x] 协议格式统一 (STX + CMD + LEN + DATA + CHECKSUM + ETX)

#### 开发记录
- **开始时间**: 2025-12-09
- **完成时间**: 2025-12-09
- **实际代码量**: 180行
- **遇到的问题**: 发现PC端和STM32端协议格式不一致
- **解决方案**: 修正PC端协议，统一使用STX(0x02)/ETX(0x03)和XOR校验

---

## 阶段2：数据管理层（优先级：高）

### 任务2.1：上位机分数显示面板

**状态**: 待开始  
**预计代码量**: 200行  
**依赖**: 任务1.2（控制面板）

#### 功能需求
- [ ] 创建分数显示面板类
- [ ] 显示本局得分（黑子 vs 白子）
- [ ] 显示总分（累计）
- [ ] 显示最高分记录
- [ ] 实现分数变化动画

#### 文件清单
**新建文件**:
- OthelloPC/gui/score_panel.py (约100行)
- OthelloPC/game/score_manager.py (约80行)

---

### 任务2.2：上位机历史回看功能

**状态**: 待开始  
**预计代码量**: 550行  
**依赖**: 无

#### 功能需求
- [ ] 创建历史回看窗口类
- [ ] 实现棋局列表显示
- [ ] 实现棋局加载功能
- [ ] 实现回放控制（前进/后退/跳转/播放/暂停）
- [ ] 实现播放速度调节
- [ ] 数据持久化（JSON格式）

#### 文件清单
**新建文件**:
- OthelloPC/gui/history_viewer.py (约250行)
- OthelloPC/game/replay_manager.py (约150行)
- OthelloPC/data/game_history.py (约100行)

---

### 任务2.3：上位机排行榜功能

**状态**: 待开始  
**预计代码量**: 400行  
**依赖**: 任务2.1（分数系统）

#### 功能需求
- [ ] 创建排行榜数据模型
- [ ] 创建排行榜窗口
- [ ] 支持不同模式的排行榜（普通/闯关/计时）
- [ ] 记录玩家名称、得分、时间、用时
- [ ] 至少保存5条记录
- [ ] 实现数据持久化（JSON文件）
- [ ] 实现排行榜导出（CSV格式）

#### 文件清单
**新建文件**:
- OthelloPC/game/leaderboard.py (约200行)
- OthelloPC/gui/leaderboard_window.py (约180行)

---

## 阶段3：游戏模式层（优先级：中）

### 任务3.1：闯关模式

**状态**: 待开始  
**预计代码量**: 450行  
**依赖**: 任务1.3, 任务1.4

#### 功能需求
**下位机**:
- [ ] 实现总分累计系统
- [ ] 实现连续输局判断（2局→OVER）
- [ ] 实现WIN显示（总分≥188）
- [ ] 实现OVER显示
- [ ] 添加LED文字显示功能

**上位机**:
- [ ] 创建闯关模式管理器
- [ ] 同步闯关进度
- [ ] 显示当前关卡和总分

#### 文件清单
**新建文件**:
- Core/Inc/challenge_mode.h (约40行)
- Core/Src/challenge_mode.c (约180行)
- Core/Src/led_text.c (约100行)
- OthelloPC/game/challenge_mode.py (约120行)

---

### 任务3.2：计时模式

**状态**: 待开始  
**预计代码量**: 380行  
**依赖**: 任务1.3, 任务1.4

#### 功能需求
**下位机**:
- [ ] 配置TIM3定时器（1秒中断）
- [ ] 实现倒计时功能
- [ ] 实现时间到自动结束
- [ ] 发送计时器更新到上位机

**上位机**:
- [ ] 创建计时模式管理器
- [ ] 显示倒计时
- [ ] 显示规定时间内得分

#### 文件清单
**新建文件**:
- Core/Inc/timed_mode.h (约30行)
- Core/Src/timed_mode.c (约150行)
- OthelloPC/game/timed_mode.py (约100行)
- OthelloPC/gui/timer_display.py (约80行)

---

## 阶段4：扩展功能层（优先级：低）

### 任务4.1：作弊模式

**状态**: 待开始  
**预计代码量**: 420行  
**依赖**: 任务1.3

#### 功能需求
**下位机**:
- [ ] 实现编辑模式切换（按键7进入）
- [ ] 实现光标移动
- [ ] 实现放置黑子（按键1）
- [ ] 实现放置白子（按键2）
- [ ] 实现清除棋子（按键0）
- [ ] 实现保存/恢复状态

**上位机**:
- [ ] 创建棋盘编辑器窗口
- [ ] 鼠标点击编辑
- [ ] 同步编辑状态到下位机

#### 文件清单
**新建文件**:
- Core/Inc/cheat_mode.h (约30行)
- Core/Src/cheat_mode.c (约200行)
- OthelloPC/gui/board_editor.py (约180行)

---

## 开发日志

### 2025-12-09
- 创建开发计划文档
- 完成任务分解和依赖分析
- ✅ **完成任务1.4：通信协议扩展**
  - 添加4个新命令定义 (CMD_GAME_CONTROL/MODE_SELECT/SCORE_UPDATE/TIMER_UPDATE)
  - 实现STM32端发送函数 (uart_protocol.c)
  - 实现PC端发送函数 (serial_handler.py)
  - 修正PC端协议格式，统一使用STX(0x02)/ETX(0x03)和XOR校验
  - 实际代码量：180行 (预计150行)
- ✅ **完成任务1.3：下位机游戏控制功能**
  - 创建game_control模块 (game_control.h/c)
  - 实现完整状态机 (IDLE/PLAYING/PAUSED/ENDED)
  - 实现按键映射 (1=开始, *=暂停, #=继续, D=结束, 0=重置)
  - 集成到main.c的按键处理和协议处理
  - 添加暂停时间统计和有效游戏时间计算
  - 实际代码量：350行 (预计300行)
- ✅ **完成任务1.2：上位机游戏控制面板**
  - 创建control_panel.py模块
  - 实现5个控制按钮（开始/暂停/继续/结束/重置）
  - 实现模式选择下拉框（普通/闯关/计时）
  - 实现按钮状态管理和状态显示
  - 集成到main_window.py
  - 实际代码量：320行 (预计200行)
- ✅ **完成任务1.1：上位机串口参数设置对话框**
  - 创建serial_settings_dialog.py模块
  - 实现完整的串口参数配置界面
  - 实现端口扫描和测试连接功能
  - 集成到main_window.py菜单
  - 更新config.py添加串口配置项
  - 实际代码量：420行 (预计250行)

---

## 验收检查清单

### 阶段1验收
- [ ] 串口参数能正确配置
- [ ] 游戏控制按钮全部正常
- [ ] 下位机和上位机控制同步
- [ ] 协议命令正确实现

### 阶段2验收
- [ ] 分数显示准确
- [ ] 历史回看功能完整
- [ ] 排行榜数据持久化

### 阶段3验收
- [ ] 闯关模式逻辑正确
- [ ] 计时模式计时准确

### 阶段4验收
- [ ] 作弊模式功能完整

---

## 代码统计

| 模块 | 新增文件 | 修改文件 | 新增代码 | 修改代码 | 总计 |
|------|---------|---------|---------|---------|------|
| 阶段1 | 3 | 5 | 750行 | 150行 | 900行 |
| 阶段2 | 6 | 3 | 1050行 | 100行 | 1150行 |
| 阶段3 | 7 | 4 | 750行 | 80行 | 830行 |
| 阶段4 | 3 | 2 | 390行 | 30行 | 420行 |
| **总计** | **19** | **14** | **2940行** | **360行** | **3300行** |

---

**文档创建**: 2025-12-09  
**最后更新**: 2025-12-09  
**文档状态**: 待审阅
