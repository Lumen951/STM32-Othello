# STM32 黑白棋硬件连接指南

## 目标硬件
- **MCU**: STM32F103C8T6
- **LED矩阵**: WS2812B-64 (8×8正方形阵列)
- **键盘**: 4×4矩阵键盘
- **通信**: USB转TTL串口模块

---

## 1. WS2812B-64 LED矩阵连接

### 接线表

| WS2812B引脚 | 连接到 | 说明 |
|:---|:---|:---|
| **U+** (电源正) | 外部5V电源 | 需要大电流供电(最大3.84A) |
| **U-** (电源地) | 外部5V电源GND + STM32 GND | 必须与STM32共地 |
| **IN** (数据输入) | STM32 **PA0** | TIM2_CH1 PWM信号 |

### 电源方案
- **推荐**: 使用5V/5A外部电源适配器供电
- **电容**: 在U+和U-之间并联100μF~1000μF电解电容稳定电源
- **共地**: 外部电源GND务必与STM32 GND连接

### 信号电平(可选优化)
- STM32输出3.3V逻辑,短距离通常可直接工作
- 如果不稳定,在PA0和IN之间加74HCT125/74HCT245电平转换

---

## 2. 4×4矩阵键盘连接

### 行线(输出)

| 键盘引脚 | STM32引脚 | 标签 | 配置 |
|:---|:---|:---|:---|
| R1 | PB12 | `KEY_R1` | GPIO输出(初始高电平) |
| R2 | PB13 | `KEY_R2` | GPIO输出(初始高电平) |
| R3 | PB14 | `KEY_R3` | GPIO输出(初始高电平) |
| R4 | PB15 | `KEY_R4` | GPIO输出(初始高电平) |

### 列线(输入)

| 键盘引脚 | STM32引脚 | 标签 | 配置 |
|:---|:---|:---|:---|
| C1 | PB5 | `KEY_C1` | GPIO输入(内部上拉) |
| C2 | PB6 | `KEY_C2` | GPIO输入(内部上拉) |
| C3 | PB7 | `KEY_C3` | GPIO输入(内部上拉) |
| C4 | PB8 | `KEY_C4` | GPIO输入(内部上拉) |

### 扫描原理
- 逐行拉低输出,检测列线电平
- 低电平表示该位置按键按下

---

## 3. UART串口连接(与PC通信)

### 接线表

| STM32引脚 | 串口模块 | 标签 | 说明 |
|:---|:---|:---|:---|
| PA9 | RX | `PC_TX` | USART1_TX |
| PA10 | TX | `PC_RX` | USART1_RX |
| GND | GND | - | 共地 |

### 通信参数
- **波特率**: 115200
- **数据位**: 8
- **停止位**: 1
- **校验**: 无

---

## 4. 电源连接

### 方案一:开发板独立供电
```
外部5V电源 ──┬──> WS2812B (U+)
             │
          GND ├──> WS2812B (U-)
             └──> STM32 GND

USB供电 ────────> STM32 5V/3.3V
```

### 方案二:统一5V供电
```
外部5V/5A电源 ──┬──> WS2812B (U+)
                ├──> STM32 5V
                │
             GND ├──> WS2812B (U-)
                └──> STM32 GND
```

---

## 5. 接线检查清单

- [ ] WS2812B电源电压为5V
- [ ] WS2812B的U-与STM32 GND连接
- [ ] WS2812B的IN连接到PA0
- [ ] 电源电容已安装(100μF~1000μF)
- [ ] 键盘行线连接到PB12-15
- [ ] 键盘列线连接到PB5-8
- [ ] UART交叉连接正确(TX→RX, RX→TX)
- [ ] 所有GND连接到同一参考地

---

## 6. 故障排查

| 现象 | 可能原因 | 解决方案 |
|:---|:---|:---|
| LED不亮 | 电源不足 | 使用大电流5V电源 |
| LED闪烁不稳定 | 信号电平问题 | 添加74HCT125电平转换 |
| LED颜色错误 | DMA配置错误 | 检查DMA为16位Half Word模式 |
| 键盘无响应 | 上拉电阻缺失 | 确认软件配置了内部上拉 |
| UART无数据 | 波特率不匹配 | 确认双方都为115200 |
| 程序异常复位 | 电源纹波大 | 增加电源滤波电容 |

---

## 7. 注意事项

1. **先接地,后接电源** - 防止静电损坏芯片
2. **电源容量充足** - WS2812B满载电流可达3.84A
3. **信号线尽量短** - 减少干扰和信号衰减
4. **不要热插拔** - 断电后再插拔连接器
5. **检查极性** - LED矩阵有方向性,注意IN/OUT标识
